1. 列出 Excel 文件
```python
def list_excel_files():
    return [
        f for f in os.listdir("data/excel_files")
        if f.endswith(".xlsx")
    ]
```

2. 读取 Excel 数据
```python
import pandas as pd

def read_excel(file_name):
    path = f"data/excel_files/{file_name}"
    df = pd.read_excel(path)

    df["总价"] = df["数量"] * df["价格"]
    total = df["总价"].sum()

    return {
        "records": df.to_dict(orient="records"),
        "total": float(total)
    }
```

3. 写入 Excel 数据
```python
import shutil
import os

def save_excel(file_name, records):
    base_path = f"data/excel_files/{file_name}"
    temp_path = f"data/excel_files/temp.xlsx"
    backup_path = f"data/excel_files/{file_name}.bak"

    df = pd.DataFrame(records)
    df["总价"] = df["数量"] * df["价格"]

    # 备份
    if os.path.exists(base_path):
        shutil.copy(base_path, backup_path)

    # 写入临时文件
    df.to_excel(temp_path, index=False)

    # 替换
    os.replace(temp_path, base_path)
```

4. 撤回功能
```python
def undo(file_name):
    base_path = f"data/excel_files/{file_name}"
    backup_path = f"{base_path}.bak"

    if os.path.exists(backup_path):
        os.replace(backup_path, base_path)
        return True
    return False
```

5. 图片写入 Excel
```python
from openpyxl import load_workbook
from openpyxl.drawing.image import Image as XLImage

def insert_images(file_name):
    path = f"data/excel_files/{file_name}"
    wb = load_workbook(path)
    ws = wb.active

    for row in range(2, ws.max_row + 1):
        image_path = ws[f"J{row}"].value  # 假设图片路径

        if image_path and os.path.exists(image_path):
            img = XLImage(image_path)
            img.width = 80
            img.height = 80
            ws.add_image(img, f"J{row}")

    wb.save(path)
```

6. 数据验证
```python
def validate(records):
    for r in records:
        if not r["内容"]:
            raise ValueError("内容不能为空")
        if r["数量"] <= 0:
            raise ValueError("数量必须大于0")
        if r["价格"] < 0:
            raise ValueError("价格不能为负")
```

7. 序号自动生成
```python
def add_index(records):
    for i, r in enumerate(records, start=1):
        r["序号"] = i
```